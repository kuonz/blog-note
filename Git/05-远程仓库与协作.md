---
author: "kuonz"
draft: false
title: "远程仓库与协作"
date: 2020-04-05
categories: ["Git"]
---
  
## 远程仓库概述

### 远程仓库介绍

远程仓库本质是一台计算机，该计算机上存储了版本数据

### 远程仓库分类

| 分类   | 例子                                |
| ------ | ----------------------------------- |
| 局域网 | 自建gitlab服务器                    |
| 互联网 | github \| gitlab \| gitee \| coding |



## 远程仓库命令

### 远程仓库管理

将本地库连接远程仓库

```shell
git remote add [远程库名] [http协议地址|ssh协议地址]
```

查看本地库连接的远程仓库列表

```shell
git remote
```

删除本地库连接的远程仓库

```shell
git remote remove [远程库名]
```

### 远程库 => 本地库

克隆整个远程仓库

```shell
git clone [http协议地址] # 通过HTTP协议
git clone [ssh协议地址]  # 通过SSH协议
```

克隆远程仓库某个分支

```shell
git clone -b [远程库分支] [http协议地址] # 通过HTTP协议
git clone -b [远程库分支] [ssh协议地址]  # 通过SSH协议
```

拉取远程仓库分支到本地库分支

```shell
git fetch [远程库名] [远程库分支]:[本地库分支]
```

拉取远程仓库分支到本地库分支并合并到工作区

```shell
git pull [远程库名] [远程库分支]:[本地库分支]
```

`git push` = `git fetch` + `git merge`

```shell
git pull [远程库名] [远程库分支]:[本地库分支]
# 等价于下面两个命令
git fetch [远程库名] [远程库分支]:[本地库分支]
git merge [本地库分支]
```

### 本地库 => 远程库

将本地库推送到远程库

```shell
git push [远程库名] [本地分支名]
```

简便写法：首次推送时带上 `-u` 参数可设置默认推送的远程仓库和分支，以后的推送不用再指明远程仓库和分支

```shell
# 首次推送，设置默认推送的远程仓库和分支
git push -u 远程库名[默认origin] 分支名
# 以后如果要推送到该远程仓库和分支，则不用再再指明远程仓库和分支
git push # 等价于 git push 远程库名[默认origin] 分支名
```

注意事项：在推送前，本地库必须拥有远程库的最新的修改，否则不能推送，即推送前一般需要使用`git pull`命令将远程库拉取到本地库

```shell
git pull 远程库名[默认origin] 分支名
```



## 远程仓库免密登录

| 方式                                | 说明                                                     |
| ----------------------------------- | -------------------------------------------------------- |
| 添加远程库时在URL中加入用户名和密码 | 可以在配置文件更改remote地址                             |
| 使用操作系统管理凭据                | 使用HTTP连接，输入账号密码后，自动将账号密码存进系统中了 |
| 使用SSH协议连接                     | 需要在远程仓库中加入SSH公钥                              |

远程库时在URL中加入用户名和密码示例

```shell
git remote add origin https://用户名:密码@github.com/xxx/xxx.git
```



## 远程仓库协作

### 同团队协作

使用gitflow工作流，gitflow工作流的分支如下

| 分支名        | 说明                                                         |
| ------------- | ------------------------------------------------------------ |
| master分支    | 线上版本，稳定版本                                           |
| dev分支       | 开发分支，所有的新开发分支和测试分支都是基于该分支           |
| 功能/开发分支 | 由dev分支拆分出来，完成开发后需要提交`pull request`请求合并到dev分支，经过`review`后合并到dev分支 |
| 测试分支      | 由dev分支拆分出来，测试过程中修复bug后，合并到dev分支，并提交`pull request`请求合并到master分支，经过`review`后合并到master分支 |
| hotfix分支    | 线上代码出现紧急bug时，在该分支上进行修复，修复后合并到master分支 |

示意图

![](/post/Git/05-远程仓库与协作-images/image-20200324070959495.png)

### 跨团队协作

背景：A开发一个项目，有本地库和远程库，B想以非团队成员的方式参与项目的开发

流程：

1. B将A的项目 `fork` 到自己的远程库中，再从自己的远程库将项目clone下来
2. B更新 `fork` 仓库中代码后 `push` 到B自己的远程库，在B自己的远程库中通过 `pull request` 请求合并代码
3. A看到 `pull request` 并 `review` 通过后，将B的新代码合并到自己的项目分支中；如果 `review` 不通过则可以关闭掉这个 `pull request`

示意图：

![](/post/Git/05-远程仓库与协作-images/image-20200324071133411.png)